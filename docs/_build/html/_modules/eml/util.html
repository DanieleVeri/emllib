
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>eml.util &#8212; Empirical Model Learning  documentation</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Empirical Model Learning  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for eml.util</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">json</span>

<span class="c1"># ===========================================================================</span>
<span class="c1"># Encode Piecewise Linear Function</span>
<span class="c1"># ===========================================================================</span>

<span class="c1"># def encode_pwl(bkd, mdl, xvars, nodes, mode=&#39;sos2&#39;, name=None):</span>
<span class="c1">#     # Cache some fields</span>
<span class="c1">#     nnodes = len(nodes[0])</span>
<span class="c1">#     # Build node amount variables</span>
<span class="c1">#     tvars = []</span>
<span class="c1">#     for i in range(nnodes):</span>
<span class="c1">#         vname = None if name is None else &#39;%s_a%d&#39; % (name, i)</span>
<span class="c1">#         tvars.append(bkd.var_cont(mdl, lb=0, ub=1, name=vname))</span>
<span class="c1">#     # Ensure that we have a convex combination</span>
<span class="c1">#     bkd.cst_eq(mdl, bkd.xpr_sum(mdl, tvars), 1)</span>
<span class="c1">#     # Link the node amounts with the node values and the model variables</span>
<span class="c1">#     for xvar, lnodes in zip(xvars, nodes):</span>
<span class="c1">#         xpr = bkd.xpr_scalprod(mdl, lnodes, tvars)</span>
<span class="c1">#         bkd.cst_eq(mdl, xvar, xpr)</span>
<span class="c1">#     # Associate an integer &quot;flag&quot; variable to each node</span>
<span class="c1">#     ivars = []</span>
<span class="c1">#     for i in range(nnodes):</span>
<span class="c1">#         vname = None if name is None else &#39;%s_f%d&#39; % (name, i)</span>
<span class="c1">#         ivars.append(bkd.var_bin(mdl, name=vname))</span>
<span class="c1">#     # Connect the node amount and flag variables</span>
<span class="c1">#     for i in range(nnodes):</span>
<span class="c1">#         bkd.cst_leq(mdl, tvars[i], ivars[i])</span>
<span class="c1">#     # No more than 2 active flag variables</span>
<span class="c1">#     xpr = bkd.xpr_sum(mdl, ivars)</span>
<span class="c1">#     bkd.cst_leq(mdl, xpr, 2)</span>
<span class="c1">#     # Non contiguous flag variables cannot be simultanously active</span>
<span class="c1">#     for i in range(nnodes):</span>
<span class="c1">#         for j in range(i+2, nnodes):</span>
<span class="c1">#             xpr = bkd.xpr_sum(mdl, [ivars[i], ivars[j]])</span>
<span class="c1">#             bkd.cst_leq(mdl, xpr, 1)</span>


<span class="c1"># ===========================================================================</span>
<span class="c1"># Genericl model descriptor</span>
<span class="c1"># ===========================================================================</span>

<div class="viewcode-block" id="ModelDesc"><a class="viewcode-back" href="../../source/eml.html#eml.util.ModelDesc">[docs]</a><span class="k">class</span> <span class="nc">ModelDesc</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Class used to shape a model descriptor</span>

<span class="sd">    A model descriptor summarize the main feature a</span>
<span class="sd">    system, in this case will be used for empirical </span>
<span class="sd">    model learning models</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">        _ml :</span>
<span class="sd">            Machine learning model </span>
<span class="sd">        _mdl : </span>
<span class="sd">            Optimization model </span>
<span class="sd">        _name : </span>
<span class="sd">            Name of the model </span>
<span class="sd">        _exps : string</span>
<span class="sd">            Expressions in the model</span>

<span class="sd">    Parameters</span>
<span class="sd">    ---------</span>
<span class="sd">        ml :</span>
<span class="sd">            Machine learning model </span>
<span class="sd">        mdl : </span>
<span class="sd">            Optimization model </span>
<span class="sd">        name : string</span>
<span class="sd">            Name of the model </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ml</span><span class="p">,</span> <span class="n">mdl</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ml</span> <span class="o">=</span> <span class="n">ml</span> <span class="c1"># ml model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mdl</span> <span class="o">=</span> <span class="n">mdl</span> <span class="c1"># opt model </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exps</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="ModelDesc.store"><a class="viewcode-back" href="../../source/eml.html#eml.util.ModelDesc.store">[docs]</a>    <span class="k">def</span> <span class="nf">store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xtype</span><span class="p">,</span> <span class="n">xidx</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Store expression </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            xtype : string  </span>
<span class="sd">                Type of expression</span>
<span class="sd">            xidx : int</span>
<span class="sd">                Index we want to use to store</span>
<span class="sd">                the expression </span>
<span class="sd">            val: </span>
<span class="sd">                Value to store  </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">xidx</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">xidx</span> <span class="o">=</span> <span class="p">(</span><span class="n">xidx</span><span class="p">,)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_exps</span><span class="p">[(</span><span class="n">xtype</span><span class="p">,)</span> <span class="o">+</span> <span class="n">xidx</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span></div>

<div class="viewcode-block" id="ModelDesc.get"><a class="viewcode-back" href="../../source/eml.html#eml.util.ModelDesc.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xtype</span><span class="p">,</span> <span class="n">xidx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get expression</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            xtype : string </span>
<span class="sd">                Type of expression</span>
<span class="sd">            xidx : int</span>
<span class="sd">                Index we want to use to store</span>
<span class="sd">                the expression </span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Expr : `generic type``</span>
<span class="sd">                Expression located by the coordinates</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">xidx</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">xidx</span> <span class="o">=</span> <span class="p">(</span><span class="n">xidx</span><span class="p">,)</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exps</span><span class="p">[(</span><span class="n">xtype</span><span class="p">,)</span> <span class="o">+</span> <span class="n">xidx</span><span class="p">]</span></div>

<div class="viewcode-block" id="ModelDesc.has"><a class="viewcode-back" href="../../source/eml.html#eml.util.ModelDesc.has">[docs]</a>    <span class="k">def</span> <span class="nf">has</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xtype</span><span class="p">,</span> <span class="n">xidx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check if the model contains an expression given some coordinares</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            xtype : string </span>
<span class="sd">                Type of expression</span>
<span class="sd">            xidx : int</span>
<span class="sd">                Index we want to use to store</span>
<span class="sd">                the expression </span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Acknowledge : bool</span>
<span class="sd">                True if the expression is present, </span>
<span class="sd">                False otherwise</span>

<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">xidx</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">xidx</span> <span class="o">=</span> <span class="p">(</span><span class="n">xidx</span><span class="p">,)</span> 
        <span class="k">return</span> <span class="p">((</span><span class="n">xtype</span><span class="p">,)</span> <span class="o">+</span> <span class="n">xidx</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exps</span></div>

<div class="viewcode-block" id="ModelDesc.expressions"><a class="viewcode-back" href="../../source/eml.html#eml.util.ModelDesc.expressions">[docs]</a>    <span class="k">def</span> <span class="nf">expressions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get all the expressions stored </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Expressions : dict(expr)</span>
<span class="sd">                Set of the expressions in the model </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exps</span></div>

<div class="viewcode-block" id="ModelDesc.name"><a class="viewcode-back" href="../../source/eml.html#eml.util.ModelDesc.name">[docs]</a>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get name of the model </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Name : string</span>
<span class="sd">                Name of the model</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span></div>

<div class="viewcode-block" id="ModelDesc.model"><a class="viewcode-back" href="../../source/eml.html#eml.util.ModelDesc.model">[docs]</a>    <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the optimization model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Optimization Model : :obj:`docplex.mp.model.Model`</span>
<span class="sd">                Combinatorial system </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mdl</span></div>

<div class="viewcode-block" id="ModelDesc.ml_model"><a class="viewcode-back" href="../../source/eml.html#eml.util.ModelDesc.ml_model">[docs]</a>    <span class="k">def</span> <span class="nf">ml_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get machine learning model </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Machine learning model : `generic type`</span>
<span class="sd">                Machine learning model </span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml</span></div>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Representation of the layer</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Representation : string</span>
<span class="sd">                String representing the layer</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> 
        <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;Model Name: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;Machine Learning Model: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;Optimization Model: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mdl</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="c1"># s += json.dumps(self._exps, indent=4, sort_keys=True)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_exps</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Empirical Model Learning  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, University of Bologna - DISI.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.
    </div>
  </body>
</html>